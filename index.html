<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>القاموس المورد القريب - index</title>
  <style>
    body {font-family: Arial, sans-serif; margin:0; background:#fff; color:#111; direction:rtl;}
    .header{background:#111;color:#fff;padding:14px;text-align:center;}
    .header h1{margin:0;font-size:20px}
    .container{padding:12px}
    .db-item{padding:10px;border-bottom:1px solid #eee;cursor:pointer}
    .words{margin-top:12px}
    .word-row{display:flex;justify-content:space-between;align-items:center;padding:8px;border-bottom:1px solid #f0f0f0}
    .word-text{font-weight:700}
    .btn{padding:6px 10px;border-radius:4px;border:none;cursor:pointer}
    .search-btn{background:#0078d7;color:#fff}
    .audio-btn{background:#4CAF50;color:#fff;margin-left:6px}
    .empty{color:#777;padding:14px;text-align:center}
  </style>
</head>
<body>
  <div class="header">
    <h1>القاموس المورد القريب — إنجليزي ⇄ عربي</h1>
  </div>

  <div class="container">
    <h3>قواعد القاموس</h3>
    <div id="databasesList"></div>

    <div class="words" id="wordsSection" style="display:none">
      <h3 id="wordsTitle"></h3>
      <div id="wordsList"></div>
    </div>
  </div>

  <script>
    // روابط ملفات JSON على GitHub (ضع روابطك هنا)
    const autoUrls = [
      "https://raw.githubusercontent.com/muhammedhaffez116-2pac/Mydatabasetest/refs/heads/main/009.json",
      "https://raw.githubusercontent.com/muhammedhaffez116-2pac/Mydatabasetest/refs/heads/main/010.json",
      "https://raw.githubusercontent.com/muhammedhaffez116-2pac/Mydatabasetest/refs/heads/main/011.json"
    ];

    let databases = [];

    function loadAllDatabases(){
      databases = [];
      const promises = autoUrls.map(url =>
        fetch(url).then(r => r.json()).then(data=>{
          const name = url.split('/').pop().replace('.json','');
          const words = Array.isArray(data) ? data : (data.words || []);
          databases.push({name, words});
        }).catch(()=>{ /* تجاهل الأخطاء الفردية */ })
      );
      Promise.all(promises).then(displayDatabases);
    }

    function displayDatabases(){
      const list = document.getElementById('databasesList');
      list.innerHTML = '';
      if(databases.length === 0){
        list.innerHTML = '<div class="empty">لا توجد قواعد متاحة</div>';
        return;
      }
      databases.forEach((db, idx) => {
        const div = document.createElement('div');
        div.className = 'db-item';
        div.textContent = db.name;
        div.onclick = ()=> showWords(idx);
        list.appendChild(div);
      });
    }

    function showWords(idx){
      const db = databases[idx];
      document.getElementById('wordsSection').style.display = 'block';
      document.getElementById('wordsTitle').textContent = 'صفحة: ' + db.name;
      const wl = document.getElementById('wordsList');
      wl.innerHTML = '';
      if(!db.words || db.words.length === 0){
        wl.innerHTML = '<div class="empty">لا توجد كلمات</div>';
        return;
      }
      db.words.forEach(obj=>{
        const w = (obj && obj.word) ? obj.word : obj;
        const row = document.createElement('div');
        row.className = 'word-row';
        const span = document.createElement('span');
        span.className = 'word-text';
        span.textContent = w;
        const actions = document.createElement('div');

        // زر فتح صفحة الكلمة (يفتح word.html؟)
        const openBtn = document.createElement('button');
        openBtn.className = 'btn search-btn';
        openBtn.textContent = 'فتح';
        openBtn.onclick = ()=> {
          // افتح صفحة منفصلة لكل كلمة مع باراميتر term
          const target = 'word.html?term=' + encodeURIComponent(w);
          // افتح في نفس النافذة (WebViewer سيحمّل هذا الرابط داخله)
          window.location.href = target;
        };

        // زر نطق
        const audioBtn = document.createElement('button');
        audioBtn.className = 'btn audio-btn';
        audioBtn.textContent = '🔊';
        audioBtn.onclick = ()=> {
          if('speechSynthesis' in window){
            const u = new SpeechSynthesisUtterance(w);
            u.lang = 'en-US';
            speechSynthesis.speak(u);
          } else alert('نطق غير مدعوم');
        };

        actions.appendChild(openBtn);
        actions.appendChild(audioBtn);
        row.appendChild(span);
        row.appendChild(actions);
        wl.appendChild(row);
      });
    }

    window.onload = loadAllDatabases;
  </script>
</body>
</html>